<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guerre des Pays</title>
    
    <style>
        /* Variables CSS */
        :root {
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --primary: #007AFF;
            --danger: #FF3B30;
            --success: #34C759;
            --text: #1C1C1E;
            --text-secondary: #8E8E93;
            --bg: #F2F2F7;
            --card-bg: rgba(255, 255, 255, 0.7);
        }

        /* Reset et base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Glassmorphism */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            margin: 10px 0;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            text-align: center;
            padding: 30px 0;
        }

        h1 {
            font-size: 2.5em;
            font-weight: 700;
            color: white;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
        }

        /* Language Selector */
        .lang-selector {
            position: absolute;
            top: 20px;
            right: 20px;
        }

        select {
            padding: 10px 20px;
            border-radius: 10px;
            border: none;
            background: white;
            font-size: 16px;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        /* Player Profile */
        .player-profile {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .player-info {
            flex: 1;
        }

        .player-info h2 {
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        .player-info p {
            color: var(--text-secondary);
        }

        /* Avatar Setup */
        .avatar-setup {
            text-align: center;
            padding: 30px;
        }

        .avatar-choice {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
        }

        /* Accessibility improvements for iPad/touch */
        .avatar-option {
            cursor: pointer;
            padding: 30px;
            border-radius: 20px;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            background: var(--card-bg);
            min-width: 150px;
            touch-action: manipulation;
        }

        .avatar-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            background: rgba(255, 255, 255, 0.9);
        }

        .avatar-option.selected {
            border-color: var(--primary);
            background: rgba(0, 122, 255, 0.1);
            transform: scale(1.05);
        }

        /* Forms */
        .form-group {
            margin: 15px 0;
            text-align: left;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--text);
        }

        input {
            width: 100%;
            padding: 16px 20px;
            border-radius: 12px;
            border: 2px solid #E5E5EA;
            font-size: 18px;
            transition: all 0.3s ease;
            min-height: 50px;
        }

        input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }

        /* Buttons */
        .btn {
            padding: 16px 32px;
            border-radius: 12px;
            border: none;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
            text-align: center;
            touch-action: manipulation;
            min-height: 50px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #0051D5;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 122, 255, 0.3);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
        }

        /* Country List */
        .countries-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .country-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
        }

        .country-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .country-flag {
            font-size: 2em;
        }

        .country-name {
            font-weight: 600;
        }

        .country-xp {
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        .country-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .status {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .status-war {
            background: rgba(255, 59, 48, 0.1);
            color: var(--danger);
        }

        .status-peace {
            background: rgba(52, 199, 89, 0.1);
            color: var(--success);
        }

        /* Marriage Section */
        .marriage-section {
            text-align: center;
            padding: 30px;
            margin: 30px 0;
        }

        .selected-countries {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }

        .selected-country {
            padding: 10px 20px;
            background: rgba(0, 122, 255, 0.1);
            border-radius: 10px;
            font-weight: 600;
        }

        /* Random Event */
        .random-event {
            text-align: center;
            margin: 30px 0;
        }

        .event-message {
            margin-top: 20px;
            padding: 20px;
            font-size: 1.2em;
            font-weight: 600;
            color: var(--primary);
        }

        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .player-profile {
                flex-direction: column;
                text-align: center;
            }

            .countries-container {
                grid-template-columns: 1fr;
            }

            .country-card {
                flex-direction: column;
                gap: 10px;
            }

            h1 {
                font-size: 2em;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .stat-card {
                padding: 15px;
            }
            
            .stat-icon {
                font-size: 2em;
            }
            
            .stat-value {
                font-size: 1.5em;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        /* Statistics Section */
        .statistics-section {
            margin-bottom: 30px;
            padding: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .stat-card:nth-child(1) .stat-value { color: var(--danger); }
        .stat-card:nth-child(2) .stat-value { color: var(--success); }
        .stat-card:nth-child(3) .stat-value { color: #E91E63; }
        .stat-card:nth-child(4) .stat-value { color: #FFD700; }

        .stat-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: 700;
            color: var(--primary);
            margin: 10px 0;
        }

        .stat-label {
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        .war-history {
            margin-top: 30px;
        }

        .war-history h4 {
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .history-list {
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
        }

        .history-item {
            padding: 8px 12px;
            margin: 5px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            font-size: 0.9em;
            animation: slideIn 0.3s ease;
        }

        .leaderboard {
            margin-top: 30px;
        }

        .leaderboard-list {
            list-style: none;
            padding: 0;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 12px;
            margin: 5px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            font-size: 0.9em;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Hide/Show */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Language Selector -->
    <div class="lang-selector">
        <select id="languageSelect" aria-label="Choisir la langue">
            <option value="fr">Français</option>
            <option value="ar">العربية</option>
            <option value="es">Español</option>
            <option value="it">Italiano</option>
            <option value="en">English</option>
        </select>
    </div>

    <!-- Header -->
    <header>
        <h1 id="gameTitle">Guerre des Pays</h1>
    </header>

    <div class="container">
        <!-- Player Profile (Hidden initially) -->
        <div id="playerProfile" class="player-profile glass hidden">
            <div class="avatar" id="playerAvatar"></div>
            <div class="player-info">
                <h2 id="playerName"></h2>
                <p id="playerDetails"></p>
            </div>
        </div>

        <!-- Avatar Setup -->
        <div id="avatarSetup" class="avatar-setup card">
            <h2 id="chooseAvatar">Choisissez votre avatar</h2>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">Cliquez sur l'avatar de votre choix</p>
            <div class="avatar-choice">
                <div class="avatar-option" data-gender="male" tabindex="0" role="button" aria-label="Choisir avatar homme">
                    <svg width="100" height="100" viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="45" fill="#4A90E2"/>
                        <circle cx="50" cy="40" r="20" fill="#FFE0BD"/>
                        <path d="M30 70 Q50 80 70 70" fill="#4A90E2"/>
                        <circle cx="40" cy="38" r="3" fill="#333"/>
                        <circle cx="60" cy="38" r="3" fill="#333"/>
                        <path d="M45 48 Q50 52 55 48" stroke="#333" stroke-width="2" fill="none"/>
                    </svg>
                    <p id="maleLabel">Homme</p>
                </div>
                <div class="avatar-option" data-gender="female" tabindex="0" role="button" aria-label="Choisir avatar femme">
                    <svg width="100" height="100" viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="45" fill="#E91E63"/>
                        <circle cx="50" cy="40" r="20" fill="#FFE0BD"/>
                        <path d="M30 70 Q50 80 70 70" fill="#E91E63"/>
                        <circle cx="40" cy="38" r="3" fill="#333"/>
                        <circle cx="60" cy="38" r="3" fill="#333"/>
                        <path d="M45 48 Q50 52 55 48" stroke="#333" stroke-width="2" fill="none"/>
                        <path d="M30 25 Q50 15 70 25" fill="#8B4513" stroke="none"/>
                    </svg>
                    <p id="femaleLabel">Femme</p>
                </div>
            </div>

            <form id="playerForm" class="hidden">
                <div class="form-group">
                    <label for="firstName" id="firstNameLabel">Prénom</label>
                    <input type="text" id="firstName" required>
                </div>
                <div class="form-group">
                    <label for="lastName" id="lastNameLabel">Nom de famille</label>
                    <input type="text" id="lastName" required>
                </div>
                <div class="form-group">
                    <label for="birthDate" id="birthDateLabel">Date de naissance</label>
                    <input type="date" id="birthDate" required>
                </div>
                <div class="form-group">
                    <label for="origin" id="originLabel">Origine</label>
                    <input type="text" id="origin" required>
                </div>
                <button type="submit" class="btn btn-primary" id="startGame">Commencer le jeu</button>
                <button type="button" class="btn btn-primary" onclick="quickStart()" style="margin-left: 10px; background: #34C759;">Jouer en tant que Yugurtha 🇩🇿</button>
                <p style="margin-top: 10px; color: var(--text-secondary); font-size: 0.9em;">Assurez-vous de remplir tous les champs</p>
            </form>
        </div>

        <!-- Game Section (Hidden initially) -->
        <div id="gameSection" class="hidden">
            <!-- Statistics Section -->
            <div class="statistics-section card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 id="statsTitle" style="margin: 0;">📊 Statistiques de Guerre</h3>
                    <button class="btn btn-small" onclick="resetStats()">🔄</button>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">⚔️</div>
                        <div class="stat-value" id="totalWars">0</div>
                        <div class="stat-label" id="warsLabel">Guerres actives</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">🕊️</div>
                        <div class="stat-value" id="totalPeace">195</div>
                        <div class="stat-label" id="peaceLabel">Pays en paix</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">💑</div>
                        <div class="stat-value" id="totalMarriages">0</div>
                        <div class="stat-label" id="marriagesLabel">Mariages célébrés</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">🏆</div>
                        <div class="stat-value" id="topCountry">-</div>
                        <div class="stat-label" id="topCountryLabel">Pays le plus fort</div>
                    </div>
                </div>
                <div class="war-history">
                    <h4 id="historyTitle">📜 Historique récent</h4>
                    <div id="historyList" class="history-list"></div>
                </div>
                <div class="leaderboard">
                    <h4 id="leaderboardTitle">🏅 Classement XP</h4>
                    <ol id="leaderboardList" class="leaderboard-list"></ol>
                </div>
            </div>

            <!-- Marriage Section -->
            <div class="marriage-section card">
                <h3 id="marriageTitle">Mariage entre pays</h3>
                <div class="selected-countries" id="selectedCountries"></div>
                <button class="btn btn-primary" id="marryBtn" disabled>Marier les pays</button>
                <div id="marriageMessage" class="event-message"></div>
            </div>

            <!-- Random Event -->
            <div class="random-event card">
                <button class="btn btn-primary" id="randomEventBtn">Random Event</button>
                <div id="eventMessage" class="event-message"></div>
            </div>

            <!-- Countries List -->
            <div class="countries-container" id="countriesList"></div>
        </div>
    </div>

    <script>
        // Translations
        const translations = {
            fr: {
                gameTitle: "Guerre des Pays",
                chooseAvatar: "Choisissez votre avatar",
                male: "Homme",
                female: "Femme",
                firstName: "Prénom",
                lastName: "Nom de famille",
                birthDate: "Date de naissance",
                origin: "Origine",
                startGame: "Commencer le jeu",
                marriageTitle: "Mariage entre pays",
                marryCountries: "Marier les pays",
                randomEvent: "Random Event",
                declareWar: "Déclarer la guerre",
                makePeace: "Faire la paix",
                war: "Guerre",
                peace: "Paix",
                select: "Sélectionner",
                selected: "Sélectionné",
                hello: "Bonjour",
                hi: "Coucou",
                iLoveYou: "Je t'aime",
                iAdoreYou: "Je t'adore",
                israelWarning: "Faire attention ! Israël qui guerre au Liban !",
                kiss: "Bisou",
                moroccanAlgerianMarriage: "Bravo ! Marocaine se marier avec Algérien 🎉",
                marriageSuccess: "Mariage réussi entre {country1} et {country2} ! 💑",
                needTwoCountries: "Sélectionnez deux pays pour les marier",
                xpPoints: "XP: {xp} points",
                statsTitle: "📊 Statistiques de Guerre",
                warsLabel: "Guerres actives",
                peaceLabel: "Pays en paix",
                marriagesLabel: "Mariages célébrés",
                topCountryLabel: "Pays le plus fort",
                leaderboardTitle: "🏅 Classement XP",
                historyTitle: "📜 Historique récent",
                warDeclared: "{country1} déclare la guerre à {country2} ⚔️",
                peaceMade: "{country1} fait la paix avec {country2} 🕊️",
                marriageCelebrated: "Mariage célébré : {country1} 💑 {country2}"
            },
            ar: {
                gameTitle: "حرب البلدان",
                chooseAvatar: "اختر صورتك الرمزية",
                male: "رجل",
                female: "امرأة",
                firstName: "الاسم الأول",
                lastName: "اسم العائلة",
                birthDate: "تاريخ الميلاد",
                origin: "الأصل",
                startGame: "ابدأ اللعبة",
                marriageTitle: "الزواج بين البلدان",
                marryCountries: "زوج البلدان",
                randomEvent: "حدث عشوائي",
                declareWar: "أعلن الحرب",
                makePeace: "اصنع السلام",
                war: "حرب",
                peace: "سلام",
                select: "اختر",
                selected: "مختار",
                hello: "مرحبا",
                hi: "أهلا",
                iLoveYou: "أحبك",
                iAdoreYou: "أعشقك",
                israelWarning: "انتبه! إسرائيل تحارب لبنان!",
                kiss: "قبلة",
                moroccanAlgerianMarriage: "مبروك! مغربية تتزوج جزائري 🎉",
                marriageSuccess: "زواج ناجح بين {country1} و {country2} ! 💑",
                needTwoCountries: "اختر دولتين للزواج",
                xpPoints: "نقاط الخبرة: {xp}",
                statsTitle: "📊 إحصائيات الحرب",
                warsLabel: "حروب نشطة",
                peaceLabel: "دول في سلام",
                marriagesLabel: "زيجات تمت",
                topCountryLabel: "أقوى دولة",
                leaderboardTitle: "🏅 الترتيب",
                historyTitle: "📜 التاريخ الحديث",
                warDeclared: "{country1} يعلن الحرب على {country2} ⚔️",
                peaceMade: "{country1} يصنع السلام مع {country2} 🕊️",
                marriageCelebrated: "زواج تم : {country1} 💑 {country2}"
            },
            es: {
                gameTitle: "Guerra de Países",
                chooseAvatar: "Elige tu avatar",
                male: "Hombre",
                female: "Mujer",
                firstName: "Nombre",
                lastName: "Apellido",
                birthDate: "Fecha de nacimiento",
                origin: "Origen",
                startGame: "Comenzar el juego",
                marriageTitle: "Matrimonio entre países",
                marryCountries: "Casar países",
                randomEvent: "Evento Aleatorio",
                declareWar: "Declarar guerra",
                makePeace: "Hacer la paz",
                war: "Guerra",
                peace: "Paz",
                select: "Seleccionar",
                selected: "Seleccionado",
                hello: "Hola",
                hi: "Hola",
                iLoveYou: "Te amo",
                iAdoreYou: "Te adoro",
                israelWarning: "¡Cuidado! ¡Israel en guerra con Líbano!",
                kiss: "Beso",
                moroccanAlgerianMarriage: "¡Bravo! Marroquí se casa con argelino 🎉",
                marriageSuccess: "¡Matrimonio exitoso entre {country1} y {country2}! 💑",
                needTwoCountries: "Selecciona dos países para casarlos",
                xpPoints: "XP: {xp} puntos",
                statsTitle: "📊 Estadísticas de Guerra",
                warsLabel: "Guerras activas",
                peaceLabel: "Países en paz",
                marriagesLabel: "Matrimonios celebrados",
                topCountryLabel: "País más fuerte",
                leaderboardTitle: "🏅 Clasificación",
                historyTitle: "📜 Historia reciente",
                warDeclared: "{country1} declara guerra a {country2} ⚔️",
                peaceMade: "{country1} hace la paz con {country2} 🕊️",
                marriageCelebrated: "Matrimonio celebrado: {country1} 💑 {country2}"
            },
            it: {
                gameTitle: "Guerra dei Paesi",
                chooseAvatar: "Scegli il tuo avatar",
                male: "Uomo",
                female: "Donna",
                firstName: "Nome",
                lastName: "Cognome",
                birthDate: "Data di nascita",
                origin: "Origine",
                startGame: "Inizia il gioco",
                marriageTitle: "Matrimonio tra paesi",
                marryCountries: "Sposa i paesi",
                randomEvent: "Evento Casuale",
                declareWar: "Dichiarare guerra",
                makePeace: "Fare la pace",
                war: "Guerra",
                peace: "Pace",
                select: "Seleziona",
                selected: "Selezionato",
                hello: "Ciao",
                hi: "Ciao",
                iLoveYou: "Ti amo",
                iAdoreYou: "Ti adoro",
                israelWarning: "Attenzione! Israele in guerra con il Libano!",
                kiss: "Bacio",
                moroccanAlgerianMarriage: "Bravo! Marocchina si sposa con algerino 🎉",
                marriageSuccess: "Matrimonio riuscito tra {country1} e {country2}! 💑",
                needTwoCountries: "Seleziona due paesi per sposarli",
                xpPoints: "XP: {xp} punti",
                statsTitle: "📊 Statistiche di Guerra",
                warsLabel: "Guerre attive",
                peaceLabel: "Paesi in pace",
                marriagesLabel: "Matrimoni celebrati",
                topCountryLabel: "Paese più forte",
                leaderboardTitle: "🏅 Classifica",
                historyTitle: "📜 Storia recente",
                warDeclared: "{country1} dichiara guerra a {country2} ⚔️",
                peaceMade: "{country1} fa la pace con {country2} 🕊️",
                marriageCelebrated: "Matrimonio celebrato: {country1} 💑 {country2}"
            },
            en: {
                gameTitle: "War of Countries",
                chooseAvatar: "Choose your avatar",
                male: "Male",
                female: "Female",
                firstName: "First name",
                lastName: "Last name",
                birthDate: "Date of birth",
                origin: "Origin",
                startGame: "Start game",
                marriageTitle: "Marriage between countries",
                marryCountries: "Marry countries",
                randomEvent: "Random Event",
                declareWar: "Declare war",
                makePeace: "Make peace",
                war: "War",
                peace: "Peace",
                select: "Select",
                selected: "Selected",
                hello: "Hello",
                hi: "Hi",
                iLoveYou: "I love you",
                iAdoreYou: "I adore you",
                israelWarning: "Be careful! Israel at war with Lebanon!",
                kiss: "Kiss",
                moroccanAlgerianMarriage: "Bravo! Moroccan marries Algerian 🎉",
                marriageSuccess: "Successful marriage between {country1} and {country2}! 💑",
                needTwoCountries: "Select two countries to marry them",
                xpPoints: "XP: {xp} points",
                statsTitle: "📊 War Statistics",
                warsLabel: "Active wars",
                peaceLabel: "Countries at peace",
                marriagesLabel: "Marriages celebrated",
                topCountryLabel: "Strongest country",
                leaderboardTitle: "🏅 Leaderboard",
                historyTitle: "📜 Recent history",
                warDeclared: "{country1} declares war on {country2} ⚔️",
                peaceMade: "{country1} makes peace with {country2} 🕊️",
                marriageCelebrated: "Marriage celebrated: {country1} 💑 {country2}"
            }
        };

        // Countries data
        const countries = [
            {name: "Afghanistan", emoji: "🇦🇫"}, {name: "Albanie", emoji: "🇦🇱"}, {name: "Algérie", emoji: "🇩🇿"},
            {name: "Andorre", emoji: "🇦🇩"}, {name: "Angola", emoji: "🇦🇴"}, {name: "Antigua-et-Barbuda", emoji: "🇦🇬"},
            {name: "Argentine", emoji: "🇦🇷"}, {name: "Arménie", emoji: "🇦🇲"}, {name: "Australie", emoji: "🇦🇺"},
            {name: "Autriche", emoji: "🇦🇹"}, {name: "Azerbaïdjan", emoji: "🇦🇿"}, {name: "Bahamas", emoji: "🇧🇸"},
            {name: "Bahreïn", emoji: "🇧🇭"}, {name: "Bangladesh", emoji: "🇧🇩"}, {name: "Barbade", emoji: "🇧🇧"},
            {name: "Bélarus", emoji: "🇧🇾"}, {name: "Belgique", emoji: "🇧🇪"}, {name: "Belize", emoji: "🇧🇿"},
            {name: "Bénin", emoji: "🇧🇯"}, {name: "Bhoutan", emoji: "🇧🇹"}, {name: "Bolivie", emoji: "🇧🇴"},
            {name: "Bosnie-Herzégovine", emoji: "🇧🇦"}, {name: "Botswana", emoji: "🇧🇼"}, {name: "Brésil", emoji: "🇧🇷"},
            {name: "Brunei", emoji: "🇧🇳"}, {name: "Bulgarie", emoji: "🇧🇬"}, {name: "Burkina Faso", emoji: "🇧🇫"},
            {name: "Burundi", emoji: "🇧🇮"}, {name: "Cambodge", emoji: "🇰🇭"}, {name: "Cameroun", emoji: "🇨🇲"},
            {name: "Canada", emoji: "🇨🇦"}, {name: "Cap-Vert", emoji: "🇨🇻"}, {name: "Centrafrique", emoji: "🇨🇫"},
            {name: "Chili", emoji: "🇨🇱"}, {name: "Chine", emoji: "🇨🇳"}, {name: "Chypre", emoji: "🇨🇾"},
            {name: "Colombie", emoji: "🇨🇴"}, {name: "Comores", emoji: "🇰🇲"}, {name: "Congo", emoji: "🇨🇬"},
            {name: "Congo (RDC)", emoji: "🇨🇩"}, {name: "Corée du Nord", emoji: "🇰🇵"}, {name: "Corée du Sud", emoji: "🇰🇷"},
            {name: "Costa Rica", emoji: "🇨🇷"}, {name: "Côte d'Ivoire", emoji: "🇨🇮"}, {name: "Croatie", emoji: "🇭🇷"},
            {name: "Cuba", emoji: "🇨🇺"}, {name: "Danemark", emoji: "🇩🇰"}, {name: "Djibouti", emoji: "🇩🇯"},
            {name: "Dominique", emoji: "🇩🇲"}, {name: "Égypte", emoji: "🇪🇬"}, {name: "Émirats arabes unis", emoji: "🇦🇪"},
            {name: "Équateur", emoji: "🇪🇨"}, {name: "Érythrée", emoji: "🇪🇷"}, {name: "Espagne", emoji: "🇪🇸"},
            {name: "Estonie", emoji: "🇪🇪"}, {name: "Eswatini", emoji: "🇸🇿"}, {name: "États-Unis", emoji: "🇺🇸"},
            {name: "Éthiopie", emoji: "🇪🇹"}, {name: "Fidji", emoji: "🇫🇯"}, {name: "Finlande", emoji: "🇫🇮"},
            {name: "France", emoji: "🇫🇷"}, {name: "Gabon", emoji: "🇬🇦"}, {name: "Gambie", emoji: "🇬🇲"},
            {name: "Géorgie", emoji: "🇬🇪"}, {name: "Ghana", emoji: "🇬🇭"}, {name: "Grèce", emoji: "🇬🇷"},
            {name: "Grenade", emoji: "🇬🇩"}, {name: "Guatemala", emoji: "🇬🇹"}, {name: "Guinée", emoji: "🇬🇳"},
            {name: "Guinée-Bissau", emoji: "🇬🇼"}, {name: "Guinée équatoriale", emoji: "🇬🇶"}, {name: "Guyana", emoji: "🇬🇾"},
            {name: "Haïti", emoji: "🇭🇹"}, {name: "Honduras", emoji: "🇭🇳"}, {name: "Hongrie", emoji: "🇭🇺"},
            {name: "Îles Marshall", emoji: "🇲🇭"}, {name: "Îles Salomon", emoji: "🇸🇧"}, {name: "Inde", emoji: "🇮🇳"},
            {name: "Indonésie", emoji: "🇮🇩"}, {name: "Irak", emoji: "🇮🇶"}, {name: "Iran", emoji: "🇮🇷"},
            {name: "Irlande", emoji: "🇮🇪"}, {name: "Islande", emoji: "🇮🇸"}, {name: "Israël", emoji: "🇮🇱"},
            {name: "Italie", emoji: "🇮🇹"}, {name: "Jamaïque", emoji: "🇯🇲"}, {name: "Japon", emoji: "🇯🇵"},
            {name: "Jordanie", emoji: "🇯🇴"}, {name: "Kazakhstan", emoji: "🇰🇿"}, {name: "Kenya", emoji: "🇰🇪"},
            {name: "Kirghizistan", emoji: "🇰🇬"}, {name: "Kiribati", emoji: "🇰🇮"}, {name: "Kosovo", emoji: "🇽🇰"},
            {name: "Koweït", emoji: "🇰🇼"}, {name: "Laos", emoji: "🇱🇦"}, {name: "Lesotho", emoji: "🇱🇸"},
            {name: "Lettonie", emoji: "🇱🇻"}, {name: "Liban", emoji: "🇱🇧"}, {name: "Liberia", emoji: "🇱🇷"},
            {name: "Libye", emoji: "🇱🇾"}, {name: "Liechtenstein", emoji: "🇱🇮"}, {name: "Lituanie", emoji: "🇱🇹"},
            {name: "Luxembourg", emoji: "🇱🇺"}, {name: "Macédoine du Nord", emoji: "🇲🇰"}, {name: "Madagascar", emoji: "🇲🇬"},
            {name: "Malaisie", emoji: "🇲🇾"}, {name: "Malawi", emoji: "🇲🇼"}, {name: "Maldives", emoji: "🇲🇻"},
            {name: "Mali", emoji: "🇲🇱"}, {name: "Malte", emoji: "🇲🇹"}, {name: "Maroc", emoji: "🇲🇦"},
            {name: "Maurice", emoji: "🇲🇺"}, {name: "Mauritanie", emoji: "🇲🇷"}, {name: "Mexique", emoji: "🇲🇽"},
            {name: "Micronésie", emoji: "🇫🇲"}, {name: "Moldavie", emoji: "🇲🇩"}, {name: "Monaco", emoji: "🇲🇨"},
            {name: "Mongolie", emoji: "🇲🇳"}, {name: "Monténégro", emoji: "🇲🇪"}, {name: "Mozambique", emoji: "🇲🇿"},
            {name: "Myanmar", emoji: "🇲🇲"}, {name: "Namibie", emoji: "🇳🇦"}, {name: "Nauru", emoji: "🇳🇷"},
            {name: "Népal", emoji: "🇳🇵"}, {name: "Nicaragua", emoji: "🇳🇮"}, {name: "Niger", emoji: "🇳🇪"},
            {name: "Nigeria", emoji: "🇳🇬"}, {name: "Norvège", emoji: "🇳🇴"}, {name: "Nouvelle-Zélande", emoji: "🇳🇿"},
            {name: "Oman", emoji: "🇴🇲"}, {name: "Ouganda", emoji: "🇺🇬"}, {name: "Ouzbékistan", emoji: "🇺🇿"},
            {name: "Pakistan", emoji: "🇵🇰"}, {name: "Palaos", emoji: "🇵🇼"}, {name: "Palestine", emoji: "🇵🇸"},
            {name: "Panama", emoji: "🇵🇦"}, {name: "Papouasie-Nouvelle-Guinée", emoji: "🇵🇬"}, {name: "Paraguay", emoji: "🇵🇾"},
            {name: "Pays-Bas", emoji: "🇳🇱"}, {name: "Pérou", emoji: "🇵🇪"}, {name: "Philippines", emoji: "🇵🇭"},
            {name: "Pologne", emoji: "🇵🇱"}, {name: "Portugal", emoji: "🇵🇹"}, {name: "Qatar", emoji: "🇶🇦"},
            {name: "République dominicaine", emoji: "🇩🇴"}, {name: "République tchèque", emoji: "🇨🇿"}, {name: "Roumanie", emoji: "🇷🇴"},
            {name: "Royaume-Uni", emoji: "🇬🇧"}, {name: "Russie", emoji: "🇷🇺"}, {name: "Rwanda", emoji: "🇷🇼"},
            {name: "Saint-Kitts-et-Nevis", emoji: "🇰🇳"}, {name: "Saint-Marin", emoji: "🇸🇲"}, {name: "Saint-Vincent", emoji: "🇻🇨"},
            {name: "Sainte-Lucie", emoji: "🇱🇨"}, {name: "Salvador", emoji: "🇸🇻"}, {name: "Samoa", emoji: "🇼🇸"},
            {name: "São Tomé-et-Principe", emoji: "🇸🇹"}, {name: "Sénégal", emoji: "🇸🇳"}, {name: "Serbie", emoji: "🇷🇸"},
            {name: "Seychelles", emoji: "🇸🇨"}, {name: "Sierra Leone", emoji: "🇸🇱"}, {name: "Singapour", emoji: "🇸🇬"},
            {name: "Slovaquie", emoji: "🇸🇰"}, {name: "Slovénie", emoji: "🇸🇮"}, {name: "Somalie", emoji: "🇸🇴"},
            {name: "Soudan", emoji: "🇸🇩"}, {name: "Soudan du Sud", emoji: "🇸🇸"}, {name: "Sri Lanka", emoji: "🇱🇰"},
            {name: "Suède", emoji: "🇸🇪"}, {name: "Suisse", emoji: "🇨🇭"}, {name: "Suriname", emoji: "🇸🇷"},
            {name: "Syrie", emoji: "🇸🇾"}, {name: "Tadjikistan", emoji: "🇹🇯"}, {name: "Tanzanie", emoji: "🇹🇿"},
            {name: "Tchad", emoji: "🇹🇩"}, {name: "Thaïlande", emoji: "🇹🇭"}, {name: "Timor oriental", emoji: "🇹🇱"},
            {name: "Togo", emoji: "🇹🇬"}, {name: "Tonga", emoji: "🇹🇴"}, {name: "Trinité-et-Tobago", emoji: "🇹🇹"},
            {name: "Tunisie", emoji: "🇹🇳"}, {name: "Turkménistan", emoji: "🇹🇲"}, {name: "Turquie", emoji: "🇹🇷"},
            {name: "Tuvalu", emoji: "🇹🇻"}, {name: "Ukraine", emoji: "🇺🇦"}, {name: "Uruguay", emoji: "🇺🇾"},
            {name: "Vanuatu", emoji: "🇻🇺"}, {name: "Vatican", emoji: "🇻🇦"}, {name: "Venezuela", emoji: "🇻🇪"},
            {name: "Vietnam", emoji: "🇻🇳"}, {name: "Yémen", emoji: "🇾🇪"}, {name: "Zambie", emoji: "🇿🇲"},
            {name: "Zimbabwe", emoji: "🇿🇼"}
        ];

        // Game state
        let currentLang = 'fr';
        let playerData = {
            gender: null,
            firstName: '',
            lastName: '',
            birthDate: '',
            origin: ''
        };
        let gameState = {
            countries: countries.map((country, index) => ({
                ...country,
                id: index,
                xp: Math.floor(Math.random() * 100),
                status: 'peace',
                selected: false
            })),
            selectedForMarriage: [],
            statistics: {
                totalWars: 0,
                totalPeace: 195,
                totalMarriages: 0,
                warHistory: [],
                marriageHistory: []
            }
        };
        
        // Count initial wars/peace (in case we change initial states later)
        gameState.statistics.totalWars = gameState.countries.filter(c => c.status === 'war').length;
        gameState.statistics.totalPeace = gameState.countries.filter(c => c.status === 'peace').length;

        // DOM Elements
        const elements = {
            languageSelect: document.getElementById('languageSelect'),
            gameTitle: document.getElementById('gameTitle'),
            chooseAvatar: document.getElementById('chooseAvatar'),
            maleLabel: document.getElementById('maleLabel'),
            femaleLabel: document.getElementById('femaleLabel'),
            firstNameLabel: document.getElementById('firstNameLabel'),
            lastNameLabel: document.getElementById('lastNameLabel'),
            birthDateLabel: document.getElementById('birthDateLabel'),
            originLabel: document.getElementById('originLabel'),
            startGameBtn: document.getElementById('startGame'),
            marriageTitle: document.getElementById('marriageTitle'),
            marryBtn: document.getElementById('marryBtn'),
            randomEventBtn: document.getElementById('randomEventBtn'),
            playerForm: document.getElementById('playerForm'),
            avatarSetup: document.getElementById('avatarSetup'),
            playerProfile: document.getElementById('playerProfile'),
            gameSection: document.getElementById('gameSection'),
            playerAvatar: document.getElementById('playerAvatar'),
            playerName: document.getElementById('playerName'),
            playerDetails: document.getElementById('playerDetails'),
            countriesList: document.getElementById('countriesList'),
            selectedCountries: document.getElementById('selectedCountries'),
            marriageMessage: document.getElementById('marriageMessage'),
            eventMessage: document.getElementById('eventMessage'),
            leaderboardList: document.getElementById('leaderboardList')
        };

        // Translation function
        function t(key, params = {}) {
            let text = translations[currentLang][key] || key;
            Object.keys(params).forEach(param => {
                text = text.replace(`{${param}}`, params[param]);
            });
            return text;
        }

        // Update UI language
        function updateLanguage() {
            elements.gameTitle.textContent = t('gameTitle');
            elements.chooseAvatar.textContent = t('chooseAvatar');
            elements.maleLabel.textContent = t('male');
            elements.femaleLabel.textContent = t('female');
            elements.firstNameLabel.textContent = t('firstName');
            elements.lastNameLabel.textContent = t('lastName');
            elements.birthDateLabel.textContent = t('birthDate');
            elements.originLabel.textContent = t('origin');
            elements.startGameBtn.textContent = t('startGame');
            elements.marriageTitle.textContent = t('marriageTitle');
            elements.marryBtn.textContent = t('marryCountries');
            elements.randomEventBtn.textContent = t('randomEvent');
            
            // Update statistics labels
            document.getElementById('statsTitle').textContent = t('statsTitle');
            document.getElementById('warsLabel').textContent = t('warsLabel');
            document.getElementById('peaceLabel').textContent = t('peaceLabel');
            document.getElementById('marriagesLabel').textContent = t('marriagesLabel');
            document.getElementById('topCountryLabel').textContent = t('topCountryLabel');
            document.getElementById('leaderboardTitle').textContent = t('leaderboardTitle');
            document.getElementById('historyTitle').textContent = t('historyTitle');
            
            // Update countries list if game is active
            if (!elements.gameSection.classList.contains('hidden')) {
                renderCountries();
            }
        }

        // Avatar selection
        document.querySelectorAll('.avatar-option').forEach(option => {
            option.addEventListener('click', function() {
                selectAvatar(this);
            });
            option.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    selectAvatar(e.target);
                }
            });
        });

        function selectAvatar(element) {
            document.querySelectorAll('.avatar-option').forEach(opt => {
                opt.classList.remove('selected');
                opt.setAttribute('aria-pressed', 'false');
            });
            element.classList.add('selected');
            element.setAttribute('aria-pressed', 'true');
            playerData.gender = element.dataset.gender;
            elements.playerForm.classList.remove('hidden');
            elements.playerForm.classList.add('fade-in');
        }

        // Form submission
        elements.playerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            playerData.firstName = document.getElementById('firstName').value;
            playerData.lastName = document.getElementById('lastName').value;
            playerData.birthDate = document.getElementById('birthDate').value;
            playerData.origin = document.getElementById('origin').value;
            
            console.log('Starting game with:', playerData);
            startGame();
        });

        // Start game
        function startGame() {
            elements.avatarSetup.classList.add('hidden');
            elements.playerProfile.classList.remove('hidden');
            elements.gameSection.classList.remove('hidden');
            
            // Display player info
            const avatarSvg = playerData.gender === 'male' ? 
                `<svg width="80" height="80" viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="45" fill="#4A90E2"/>
                    <circle cx="50" cy="40" r="20" fill="#FFE0BD"/>
                    <path d="M30 70 Q50 80 70 70" fill="#4A90E2"/>
                    <circle cx="40" cy="38" r="3" fill="#333"/>
                    <circle cx="60" cy="38" r="3" fill="#333"/>
                    <path d="M45 48 Q50 52 55 48" stroke="#333" stroke-width="2" fill="none"/>
                </svg>` :
                `<svg width="80" height="80" viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="45" fill="#E91E63"/>
                    <circle cx="50" cy="40" r="20" fill="#FFE0BD"/>
                    <path d="M30 70 Q50 80 70 70" fill="#E91E63"/>
                    <circle cx="40" cy="38" r="3" fill="#333"/>
                    <circle cx="60" cy="38" r="3" fill="#333"/>
                    <path d="M45 48 Q50 52 55 48" stroke="#333" stroke-width="2" fill="none"/>
                    <path d="M30 25 Q50 15 70 25" fill="#8B4513" stroke="none"/>
                </svg>`;
            
            elements.playerAvatar.innerHTML = avatarSvg;
            elements.playerName.textContent = `${playerData.firstName} ${playerData.lastName}`;
            
            // Add special badge for Yugurtha
            if (playerData.firstName === 'Yugurtha') {
                elements.playerName.innerHTML = `${playerData.firstName} ${playerData.lastName} <span style="font-size: 0.8em; color: gold;">👑</span>`;
            }
            
            // Display birthdate nicely
            const birthDate = new Date(playerData.birthDate);
            const age = new Date().getFullYear() - birthDate.getFullYear();
            const dateStr = birthDate.toLocaleDateString(currentLang, { day: 'numeric', month: 'long', year: 'numeric' });
            
            // Special flag for Algerian players
            const flagEmoji = playerData.origin.toLowerCase().includes('algér') ? ' 🇩🇿' : '';
            elements.playerDetails.textContent = `${playerData.origin}${flagEmoji} • ${age} ans • ${dateStr}`;
            
            // Give Algeria extra XP if player is Algerian
            if (playerData.origin.toLowerCase().includes('algér')) {
                const algeria = gameState.countries.find(c => c.name === 'Algérie');
                if (algeria) {
                    algeria.xp = 100;
                }
                // Special welcome message for Algerian players
                setTimeout(() => {
                    if (playerData.firstName === 'Yugurtha') {
                        alert('Bienvenue Yugurtha ! 🇩🇿 One Two Three Viva l\'Algérie! 💪');
                    }
                }, 500);
            }
            
            // Always give Palestine max XP
            const palestine = gameState.countries.find(c => c.name === 'Palestine');
            if (palestine) {
                palestine.xp = 100;
            }
            
            renderCountries();
            updateStatistics();
        }

        // Render countries
        function renderCountries() {
            elements.countriesList.innerHTML = '';
            
            gameState.countries.forEach(country => {
                const countryCard = document.createElement('div');
                countryCard.className = 'country-card card fade-in';
                
                // Special styling for Algeria and Palestine
                if (country.name === 'Algérie' || country.name === 'Palestine') {
                    countryCard.style.background = 'linear-gradient(135deg, rgba(0, 255, 0, 0.1), rgba(255, 255, 255, 0.7))';
                    countryCard.style.border = '2px solid #34C759';
                }
                
                const statusClass = country.status === 'war' ? 'status-war' : 'status-peace';
                const statusText = country.status === 'war' ? t('war') : t('peace');
                const actionBtn = country.status === 'war' ? 
                    `<button class="btn btn-success btn-small" onclick="toggleWarPeace(${country.id})">${t('makePeace')}</button>` :
                    `<button class="btn btn-danger btn-small" onclick="toggleWarPeace(${country.id})">${t('declareWar')}</button>`;
                
                const selectBtn = country.selected ? 
                    `<button class="btn btn-primary btn-small" onclick="toggleMarriageSelection(${country.id})">${t('selected')}</button>` :
                    `<button class="btn btn-primary btn-small" onclick="toggleMarriageSelection(${country.id})">${t('select')}</button>`;
                
                countryCard.innerHTML = `
                    <div class="country-info">
                        <span class="country-flag">${country.emoji}</span>
                        <div>
                            <div class="country-name">${country.name}</div>
                            <div class="country-xp">${t('xpPoints', {xp: country.xp})}</div>
                        </div>
                    </div>
                    <div class="country-actions">
                        <span class="status ${statusClass}">${statusText}</span>
                        ${actionBtn}
                        ${selectBtn}
                    </div>
                `;
                
                elements.countriesList.appendChild(countryCard);
            });
        }

        // Update statistics display
        function updateStatistics() {
            document.getElementById('totalWars').textContent = gameState.statistics.totalWars;
            document.getElementById('totalPeace').textContent = gameState.statistics.totalPeace;
            document.getElementById('totalMarriages').textContent = gameState.statistics.totalMarriages;
            
            // Find country with highest XP
            const topCountry = gameState.countries.reduce((prev, current) => 
                (prev.xp > current.xp) ? prev : current
            );
            const topCountryElement = document.getElementById('topCountry');
            topCountryElement.textContent = `${topCountry.emoji} ${topCountry.name}`;
            
            // Special styling for Algeria
            if (topCountry.name === 'Algérie') {
                topCountryElement.style.animation = 'pulse 2s infinite';
                topCountryElement.style.textShadow = '0 0 10px rgba(0,255,0,0.5)';
            }
            
            // Update history
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';
            const recentHistory = [...gameState.statistics.warHistory, ...gameState.statistics.marriageHistory]
                .sort((a, b) => b.timestamp - a.timestamp)
                .slice(0, 10);
            
            recentHistory.forEach(event => {
                const item = document.createElement('div');
                item.className = 'history-item';
                item.textContent = event.text;
                historyList.appendChild(item);
            });

            // Update leaderboard
            elements.leaderboardList.innerHTML = '';
            [...gameState.countries]
                .sort((a, b) => b.xp - a.xp)
                .slice(0, 5)
                .forEach((country, index) => {
                    const li = document.createElement('li');
                    li.className = 'leaderboard-item';
                    li.textContent = `${index + 1}. ${country.emoji} ${country.name} - ${country.xp} XP`;
                    elements.leaderboardList.appendChild(li);
                });
        }

        // Toggle war/peace
        window.toggleWarPeace = function(countryId) {
            const country = gameState.countries.find(c => c.id === countryId);
            const wasWar = country.status === 'war';
            country.status = wasWar ? 'peace' : 'war';
            country.xp += wasWar ? 10 : -10;
            country.xp = Math.max(0, Math.min(100, country.xp));
            
            // Update statistics
            if (wasWar) {
                gameState.statistics.totalWars--;
                gameState.statistics.totalPeace++;
                gameState.statistics.warHistory.push({
                    timestamp: Date.now(),
                    text: t('peaceMade', {country1: playerData.firstName, country2: country.name})
                });
            } else {
                gameState.statistics.totalWars++;
                gameState.statistics.totalPeace--;
                gameState.statistics.warHistory.push({
                    timestamp: Date.now(),
                    text: t('warDeclared', {country1: playerData.firstName, country2: country.name})
                });
            }
            
            // Special celebration for Algeria reaching 100 XP
            if (!wasWar && country.name === 'Algérie' && country.xp >= 100 && playerData.firstName === 'Yugurtha') {
                setTimeout(() => {
                    alert('🇩🇿 ALGÉRIE CHAMPION ! 🏆\nOne Two Three Viva l\'Algérie!\nYugurtha le conquérant! 💪');
                }, 500);
            }
            
            // Achievement for war milestones
            if (!wasWar && gameState.statistics.totalWars === 10) {
                setTimeout(() => {
                    alert('🏆 ACHIEVEMENT DÉBLOQUÉ!\n⚔️ Seigneur de Guerre - 10 guerres déclarées!');
                }, 500);
            }
            
            updateStatistics();
            renderCountries();
        }

        // Toggle marriage selection
        window.toggleMarriageSelection = function(countryId) {
            const country = gameState.countries.find(c => c.id === countryId);
            
            if (country.selected) {
                country.selected = false;
                gameState.selectedForMarriage = gameState.selectedForMarriage.filter(id => id !== countryId);
            } else {
                if (gameState.selectedForMarriage.length < 2) {
                    country.selected = true;
                    gameState.selectedForMarriage.push(countryId);
                }
            }
            
            updateMarriageSection();
            renderCountries();
        }

        // Update marriage section
        function updateMarriageSection() {
            elements.selectedCountries.innerHTML = '';
            gameState.selectedForMarriage.forEach(id => {
                const country = gameState.countries.find(c => c.id === id);
                const div = document.createElement('div');
                div.className = 'selected-country';
                div.textContent = `${country.emoji} ${country.name}`;
                elements.selectedCountries.appendChild(div);
            });
            
            elements.marryBtn.disabled = gameState.selectedForMarriage.length !== 2;
        }

        // Marriage
        elements.marryBtn.addEventListener('click', () => {
            if (gameState.selectedForMarriage.length === 2) {
                const country1 = gameState.countries.find(c => c.id === gameState.selectedForMarriage[0]);
                const country2 = gameState.countries.find(c => c.id === gameState.selectedForMarriage[1]);
                
                // Check for special Morocco-Algeria marriage
                const isMoroccoAlgeria = 
                    (country1.name === 'Maroc' && country2.name === 'Algérie') ||
                    (country1.name === 'Algérie' && country2.name === 'Maroc');
                
                if (isMoroccoAlgeria) {
                    elements.marriageMessage.textContent = t('moroccanAlgerianMarriage');
                } else {
                    elements.marriageMessage.textContent = t('marriageSuccess', {
                        country1: country1.name,
                        country2: country2.name
                    });
                }
                
                // Update statistics
                gameState.statistics.totalMarriages++;
                gameState.statistics.marriageHistory.push({
                    timestamp: Date.now(),
                    text: t('marriageCelebrated', {country1: country1.name, country2: country2.name})
                });
                
                // Increase XP for married countries
                country1.xp = Math.min(100, country1.xp + 20);
                country2.xp = Math.min(100, country2.xp + 20);
                
                // Achievement for marriage milestones
                if (gameState.statistics.totalMarriages === 5) {
                    setTimeout(() => {
                        alert('🏆 ACHIEVEMENT DÉBLOQUÉ!\n💑 Cupidon International - 5 mariages célébrés!');
                    }, 500);
                }
                
                // Reset selection
                gameState.selectedForMarriage.forEach(id => {
                    const country = gameState.countries.find(c => c.id === id);
                    country.selected = false;
                });
                gameState.selectedForMarriage = [];
                updateMarriageSection();
                updateStatistics();
                renderCountries();
                
                setTimeout(() => {
                    elements.marriageMessage.textContent = '';
                }, 5000);
            }
        });

        // Random event
        elements.randomEventBtn.addEventListener('click', () => {
            const events = [
                t('hello'),
                t('hi'),
                t('iLoveYou'),
                t('iAdoreYou'),
                t('israelWarning'),
                t('kiss'),
                t('moroccanAlgerianMarriage')
            ];
            
            const randomEvent = events[Math.floor(Math.random() * events.length)];
            elements.eventMessage.textContent = randomEvent;
            
            setTimeout(() => {
                elements.eventMessage.textContent = '';
            }, 5000);
        });

        // Language change
        elements.languageSelect.addEventListener('change', (e) => {
            currentLang = e.target.value;
            document.documentElement.lang = currentLang;
            document.dir = currentLang === 'ar' ? 'rtl' : 'ltr';
            updateLanguage();
        });

        // Quick start for testing
        window.quickStart = function() {
            playerData.gender = 'male';
            playerData.firstName = 'Yugurtha';
            playerData.lastName = 'Adel';
            playerData.birthDate = '1998-11-20';
            playerData.origin = 'Algérien';
            startGame();
        }
        
        // Reset statistics
        window.resetStats = function() {
            gameState.statistics = {
                totalWars: 0,
                totalPeace: gameState.countries.length,
                totalMarriages: 0,
                warHistory: [],
                marriageHistory: []
            };
            gameState.countries.forEach(country => {
                country.status = 'peace';
                country.xp = Math.floor(Math.random() * 100);
            });
            // Keep Algeria and Palestine at 100 XP
            const algeria = gameState.countries.find(c => c.name === 'Algérie');
            const palestine = gameState.countries.find(c => c.name === 'Palestine');
            if (algeria) algeria.xp = 100;
            if (palestine) palestine.xp = 100;
            updateStatistics();
            renderCountries();
        }

        // Initialize
        updateLanguage();
    </script>
</body>
</html>
